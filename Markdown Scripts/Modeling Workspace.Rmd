---
title: "Modeling Workspace"
author: "William Morgan"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output: pdf_document
---

```{r setup, include=FALSE}
rm(list = ls())
knitr::opts_chunk$set(echo = FALSE, fig.align = 'center')
libs <- c('readxl', 'tidyverse', 'data.table', 'glmnet')
lapply(libs, library, character.only = TRUE)
```

## __Problem Outline__

What do we want to answer?

- _Q1:_ Does faculty activity on discussion forums affect student engagement on forums?

- _Q2:_ How do student outcomes change with the level of engagement in online forums?
If there is a change, it is independent of who is doing the posting?

- _Q3:_ Is the importance of faculty engagement constant throughout the course or are
there specific points in time where students benefit more from faculty engagement?


***

## __Preliminary Feature Search__

We have some expectations on which variables might carry the most signal, but it
is worth doing some investigation in case there is something we overlooked. Our
first objective will be creating a correlation heat map of all the variables
that we anticipate using, including the responses we wish to test.

This section will be relatively brief, as we prefer to avoid a deep dive into 
the potential feature space. Instead, we will adopt methods that help us in selecting
appropriate features.

```{r load prep data}
# Load and factorize
forum <- read_csv("Data/forum_cleaned.csv", col_types = cols()) %>%
  mutate(session_a = if_else(session_code == "A", 1, 0)) %>%          # create binary for session
  mutate_at(vars(session_a, has_hallway, upper_division), as.factor) %>%
  select(-session_code)

# Create matrix for correlation analysis
forum_mat <- forum %>%
  select(-course_id) %>%
  mutate_all(as.numeric) %>%
  as.matrix

```

```{r correlation graph, message=FALSE, warning=FALSE}
# Create correlation matrix and grab lower half
cormat <- round(cor(forum_mat), 2)
cormat[upper.tri(cormat)] <- NA

# reshape for plotting
cormat <- melt(cormat, na.rm = TRUE) %>%
  rename(correlation = value)


heatmap <- ggplot(cormat, aes(Var1, Var2, fill = correlation)) + 
           geom_tile(color = 'white') +
           scale_fill_gradient2(low = 'blue', high = 'red', mid = 'white',
                                midpoint = 0, limit = c(-1, 1)) +
           theme(axis.text.x = element_text(angle = 45,
                                            vjust = 1,
                                            size = 10,
                                            hjust = 1),
                 axis.title.x = element_blank(),
                 axis.title.y = element_blank(),
                 axis.ticks = element_blank(),
                 panel.border = element_blank(),
                 panel.background = element_blank(),
                 legend.justification = c(1,0),
                 legend.position = c(.5, .7),
                 legend.direction = 'horizontal')

# add labels to items with abs_val greater than .15
heatmap + 
  geom_text(data = cormat[abs(cormat$correlation) > .15, ],
            aes(Var1, Var2, label = correlation),
            color = 'black',
            size = 3)
ggsave("Graphics/correlation heatmap.png")
```

***

## __Research Question 1__

Does faculty activity on discussion forums affect student posting behavior?

Based on the available data, we can use several metrics for student behavior on
discussion forums:

- number of posts per student (over the entire course)

- average length of posts made by students

- consistency of student posts (from week to week)

  - variance of the number of posts in week X


Notes:

We need to be careful about what we choose to include in these models because some
things might not be interpretable in a meaningful way. If we were to use `pass_rate`
as a predictor and find that it has a positive effect on say the number of posts
per student, what would our interpretation be? That increasing the pass rate of 
a course creates more student discussion? That's silly and feels like some sort
of logical fallacy. 

  - generally the problem is: A is caused by B even though B occurs after A 
  
With that said, we can still use things that are fixed or occur during the course.
Class sizes, existence of hallway forums, faculty activity, and others can all
be a part of this question.

Another caveat with this question is that our sample won't depend on missing 
values for the course survey data. This should add in at least 2100 new observations,
given that those also do not have missing data for any of the other variables we
are using.

***

## __Future Options__

- can we add data about instructors making announcements?

- what peoplesoft data can be used?



***

## __Working Notes__

- research questions should be reordered; train of thought should be:

  - does faculty activity on forums affect grade outcomes?
  
    - what characteristics of faculty activity have greatest effect? (early
    course posts, late course posts, consistency of posting)

  - does faculty activity on forums affect student activity on forums?
  
    - what student activity do we want to measure?
    
***

## __To-Do:__

- sample selection needs to be dynamic; this is probably best resolved after
developing Q2, Q3 more so you know exactly what sample is needed in each

- decide on new variables that need to be created and stick to it; no need to 
go crazy

- decide if you're going to extend the prelim feature analysis
---
title: "ASUO Forum Usage"
author: "Will Morgan"
date: "August 29, 2018"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE,
                      message = FALSE,
                      warning = FALSE,
                      eval = FALSE)

libs <- c("data.table", "ggplot2", "knitr", "dplyr")
lapply(libs, library, character.only = TRUE)

path <- here::here("Data", "thread_cleaned.csv")
data <- fread(path)

# # outside 99.9% quantile
# temp <- data %>%
#   filter(thread_participants <= 36,
#          thread_length <= 78,
#          student_responses <= 74,
#          stu_stu_resp <= 54,
#          stu_fac_resp <= 40,
#          thread_width <= 9,
#          parent_views <= 171,
#          thread_lifetime <= 180,                  # limit to within course
#          studs_in_thread <= 35)
```

## Executive Summary

laskjhdflaskjhlajhfg


## Motivation

Forums are a feature used by nearly all ASU Online courses. Usage varies by 
course type but in many cases it is the only conduit for group communication
amongst students and instructors. Hence, it is important to understand the types
of interactions that are taking place and their relationship with observable
outcomes so that we can inform instructional designers and instructors on factors
that positively affect these outcomes. This preliminary research document intends
to explore the nature of forum use with the use of thread-level data extracted 
from Blackboard discussion forums. In particular, we are interested in understanding
who is starting and participating in discussions, how long they are lasting, and
how deep the conversations are. We also seek to understand the types of interactions
that are occurring in forum threads as well as instructor responsiveness to student
posts. 


## Data Source
Our data is gathered from 1.98 million forum threads and encompasses over 5.9 million
posts. It spans 7750 Blackboard course-shells from Spring 2016 through Summer 2018
and excludes graduate courses, leaving a total of 1100 unique courses. We use only
Session A or Session B courses and exclude courses that have irregular course
structures or grading schemes. Finally, we exclude posts of irregularly high length.
After navigating to the individual forum webpage, we found that these
types of posts were generally instructors disseminating huge amounts of information at
once, so we determined that these posts were not of interest to this study as they
did not represent an actual instance of instructor or student-led discussion.

*** 

\newpage

## Conversation Starters

We first want to observe how often each instructors and students are 
starting threads, so that we can understand who is initiating discussions. In the overall
sample, 97% of threads were made by students, indicating that students are
the ones intiating most of the activity on discussion forums. This number should not
necessarily raise any concerns about instrutor activity, as courses will often
have entire forums dedicated to student-initiated threads. For instance, an instructor
might create a forum where students post responses to an essay or discussion
prompt found elsewhere in the course. 

When we filter out threads that have less than 5 total posts, this proportion
evens out slightly - 20% percent of threads with 5 or more posts are initiated by instructors.
If we make this exclusion more strict and only look at threads with 10 or more posts,
instructor-led threads actually dominate student-led threads, albeit only by 7%. In
any case, the pattern seems to be that longer discussions tend to be initiated 
by instructors rather than students.

```{r}
data %>%
  mutate(`Thread Owner` = if_else(thread_owner_role == "P", "Instructor", "Student")) %>%
  group_by(`Thread Owner`) %>%
  summarise(`Number of Threads` = n(),
            `Proportion of Threads` = n() / nrow(data)) %>%
  kable(caption = "Thread Ownership")
```


```{r}
data %>%
  filter(thread_length >= 5) %>%
  mutate(`Thread Owner` = if_else(thread_owner_role == "P", "Instructor", "Student")) %>%
  group_by(`Thread Owner`) %>%
  summarise(`Number of Threads` = n(),
            `Proportion of Threads` = n() / nrow(filter(data, thread_length >= 5))) %>%
  kable(caption = "Ownership of threads with 5 or more posts")

data %>%
  filter(thread_length >= 10) %>%
  mutate(`Thread Owner` = if_else(thread_owner_role == "P", "Instructor", "Student")) %>%
  group_by(`Thread Owner`) %>%
  summarise(`Number of Threads` = n(),
            `Proportion of Threads` = n() / nrow(filter(data, thread_length >= 10))) %>%
  kable(caption = "Ownership of threads with 10 or more posts")

```



## Thread Participants

We have a sense of the types of users creating threads, so we now must 
check how many people are actually participating in them. On average, less
than 3 users are participating in any given thread. Furthermore, almost 84% of all
threads have 3 or less users and 32% have only a single user. The single-user
threads are almost always created by students but instructor-initiated threads
with a single user make up nearly half of all threads created by instructors. One
might assume then that a large fraction of instructor threads are not used for
discussion but perhaps broadcasting information to many students at once, like
a discussion prompt or forum guidelines. These types of threads would presumably
have a higher amount of views then other single-participant threads, and in fact
we do have some mild evidence in favor of this. There is a significant difference
between student and instructor-led threads in the number of views they receive, but
the gap only favors instructor threads by about 9 views. In smaller courses this
could be the difference between all students seeing the thread and none of them
seeing it but for larger courses this difference probably won't mean much.

```{r parent_views mean test, echo = FALSE, message = FALSE, eval = FALSE}
# Single participant parent_views mean test
pv1 <- data[thread_participants == 1 & thread_owner_role == "P", parent_views]
pv2 <- data[thread_participants == 1 & thread_owner_role == "S", parent_views]

t.test(pv1, pv2)

# single participant parent_post_length mean test
ppl1 <- data[thread_participants == 1 & thread_owner_role == "P", parent_post_length]
ppl2 <- data[thread_participants == 1 & thread_owner_role == "S", parent_post_length]

t.test(ppl1, ppl2)


## Thread participants by thread owner type
filter(data, thread_participants <= 30) %>%
  ggplot() +
  geom_bar(aes(thread_participants, y = (..count..) / sum(..count..), fill = factor(thread_owner_role)), position = 'fill', alpha = 0.75)



```

The broader idea here is that threads on average have very few users and that 
most of the time they are only made up of students. This seems to indicate that
ASU Online discussion forums are being used primarily for communication between 
very small groups of students. Our data does not contain the actual written
content of the posts, but a reasonable explanation for this pattern might be 
that each thread is generally one student replying to a discussion prompt,
and another student (and possibly a third) replying to that initial post.

Even when faculty do post in threads, the number of participants remains roughly
the same. The proportion of posts made by faculty evens out significantly, but
there isn't much to conclude from this specific result - when there are only two
people in a thread and you know one of them is the instructor, it shouldn't be
terribly surprising that about half of the posts come from faculty. 


```{r, echo = FALSE, message = FALSE, eval = FALSE}
data %>%
  select(thread_participants, pr_posts_stu, pr_posts_fac) %>%
  rename(`Number of Participants` = thread_participants,
         `Proportion of posts made by Students` = pr_posts_stu,
         `Proportion of posts made by Faculty` = pr_posts_fac) %>%
  summary() %>%
  kable(caption = "Student and Faculty thread participation")

data %>%
  filter(num_fac_posts >= 1) %>%
  select(thread_participants, pr_posts_stu, pr_posts_fac) %>%
  rename(`Number of Participants` = thread_participants,
         `Proportion of posts made by Students` = pr_posts_stu,
         `Proportion of posts made by Faculty` = pr_posts_fac) %>%
  summary() %>%
  kable(caption = "Student and Faculty thread participation")

```

With that said, it is important to recognize that students need not be actively
posting to see the content being written. It can still be beneficial for someone to
see what faculty and other students are writing, even if they are not part of a thread.
"Lurkers", as they are commonly referred to, are users who do exactly this - 
they read the ongoing conversation without participating. Although they may
not be outwardly expressing themselves, exposure to the differing opinions
of their peers and instructors can force students to think more critically
about course content. Although we are unable to directly observe lurking, we can
see how many times a parent post has been viewed. So, if a thread has far more
views than it does posts, we could assume that some of this viewing is being 
done by lurkers. Of course, this could also mean that the people posting are returning
to the thread to check for responses, but the point is that having more views
than posts allows for the possibility of lurking. In the data, we actually
observe this phenomenon pretty frequently. About 60% of the data has twice as many
views as it does posts, suggesting that lurking might actually be a common feature of
ASUO forums.


```{r}
cat("Median ratio of views to number of posts: ", round(median(data$parent_views / data$thread_length, na.rm = TRUE), 2))
```


## Thread Length

So far we've established that forum threads are generally student-initiated
and have only a few participants. These findings don't necessarily imply that
thread activity is lacking -  it could simply be that conversations among smaller
groups of students are the norm. One of the primary indicators of thread activity
is its length, which we define as the total number of posts. Of the 1.98 million threads 
in this data set, 59% of them have up to two posts and 78% have no more than three.
Only 12% of threads contain 5 or more posts. Briefly put, most threads in ASUO
forums are very short, supporting our working "post and a reply" theory.

```{r, echo = FALSE, message = FALSE}
data %>%
  select(thread_length) %>%
  summary() %>%
  kable()

data %>%
  mutate(`Thread Length` = if_else(thread_length < 10, as.character(thread_length), "More than 10")) %>%
  group_by(`Thread Length`) %>%
  summarise(prop = (n() / nrow(data))) %>%
  ggplot(aes(`Thread Length`, prop)) +
  geom_bar(stat = 'identity')

data %>%
  filter(thread_length <= 15) %>%
  ggplot(aes(thread_length)) +
  stat_ecdf()

```


An alternative metric we devised is the width of a thread, whose purpose is to
quantify the depth of the conversation in the thread. In other words, this measure
was created to observe back-and-forth conversation, where one user
will reply to a post, the original poster will reply to that, and so on. We 
define a thread's width by the maximum number of "chain" replies in a thread. As
an example, imagine a thread with just one post - we would define this thread to have a width of 0. When 
someone replies to that post, the width increases to 1 and if someone responds to that
reply the width will increase again to 2, and so on. To contrast, if there exists
a post with 10 replies but they are all replying to the parent post, that thread
will only have width 1, as there are no chain replies that continue the conversation.
The maximum width of a thread is bounded above by the length of the thread minus 1,
so our results thus far carry over to this measure. In fact, 86% of threads have
a width of either 0 or 1, indicating a very limited amount of back-and-forth 
collaborative discussion taking place. Longer threads have marginally higher
thread width but it is a very slight improvement. Threads with 5 or more posts
have an average width of 2 and threads with at least 10 posts hover around a width
of 3. This is an encouraging result for measuring user engagement, but these threads
represent only 12% and 2% of the data, respectively.

Disaggregating length by thread owner reveals that instructor-led
threads do have more posts on average, but the difference is not all that large.
After trimming any outliers, these threads have approximately 0.75 more posts per thread.
Similarly, threads with at least one faculty post have about one more post on
average than threads with no faculty posts. This marginal difference suggests that
that instructor posts might have some impact on overall user engagement but the effect
is likely small. 

```{r, echo = FALSE, message = FALSE, eval = FALSE}
# instr-started threads longer than student ones
tl1 <- data[thread_owner_role == "P" & thread_length <= 16, thread_length]
tl2 <- data[thread_owner_role == "S" & thread_length <= 16, thread_length]

t.test(tl1, tl2)


# thread length with one fac post
tl3 <- data[num_fac_posts > 0 & thread_length <= 16, thread_length]
tl4 <- data[num_fac_posts == 0 & thread_length <= 16, thread_length]

t.test(tl3, tl4)

data %>%
  filter(thread_length <= quantile(thread_length, 0.99)) %>%
  mutate(fac_posted = if_else(num_fac_posts > 0, "At least one post", "No faculty posts")) %>%
  ggplot(aes(fac_posted, thread_length)) +
  geom_boxplot()


### pps remain the same with more than 5 posts?
pps1 <- data[thread_length >= 5, posts_per_student]
pps2 <- data[thread_length < 5, posts_per_student]

t.test(pps1, pps2)

data %>%
  filter(posts_per_student <= quantile(posts_per_student, 0.99)) %>%
  mutate(thread_type = if_else(thread_length >= 5, "5 or More", "Less than 5")) %>%
  ggplot(aes(thread_type, posts_per_student)) + 
  geom_boxplot()
```

In the few threads that do have a significant number of posts we might expect
there to be lengthier user interactions. We are able to directly
measure this by observing the number of posts per student and the thread width as
defined earlier. Generally speaking both metrics measure the amount of interaction
an individual has with a given thread, but there is an important distinction that
should be noted. The number of posts per student specifically measures repeated
interaction with a thread no matter what post the student is responding to. On the
other hand, the width of a thread represents the amount of back-and-forth 
interaction and does not take into account the type of users. 
Threads with a high number of posts per student and low width is indicative of
good individual presence but poor depth of interaction. To contrast, a thread with
a low number of posts per student and high width would imply high levels of interaction
but limited presence. Ideally, longer threads would see increases in at least one
of these metrics. In the data, we observe an increase in both. The number of posts
per student and thread width both have a positive relationship with thread length.
However, it is not clear if the relationship is necessarily strong enough to have
a significant impact on the quality and quantity of user interaction. The mean number
of posts per student does not exceed 3 posts until threads are 20 posts long, which
seldom happens. Thread width increases faster with more posts - by the time
a thread reaches 10 posts it will have a width of 3 on average, indicating a moderate
amount of conversation between users in larger threads. This is a promising result
but it should be stressed that a very small minority of all threads even make it past
the third post.


```{r, echo = FALSE, message = FALSE, eval = FALSE}
data %>%
  filter(thread_length <= 30) %>%
  group_by(thread_length) %>%
  summarise(posts_per_student = mean(posts_per_student)) %>%
  ggplot(aes(thread_length, posts_per_student)) +
  geom_bar(stat = 'identity')

data %>%
  filter(thread_length <= 30) %>%
  group_by(thread_length) %>%
  summarise(thread_width = mean(thread_width)) %>%
  ggplot(aes(thread_length, thread_width)) +
  geom_bar(stat = 'identity')

```



## Characterizing responses

Social presence is an important determinant of student success. This is especially
true for online students, who are inherently detached from the classroom and must
interact with peers and faculty through digital means. The discussion forum
is meant to be one venue for this type of interaction, so it is important to understand
the quantity and types of interactions taking place in order to evaluate its efficacy.
In this setting there are two types of users (students and instructors), providing
four possible combinations of user-to-user interaction. We first analyze student
response behavior before transitioning to faculty response behavior. Before
continuing however, it should be noted that 30% of all threads created in
this data set do not have any sort of response and are thus excluded from this 
section. 

Threads rarely have more than a couple student responses - 80% have two or less.
There was a statistically significant increase in the number of student responses
when the thread was created by a faculty member, so it does appear that students
are more responsive to faculty. A t-test revealed that this difference is only
very slight, around 0.8 more posts when made by faculty.

```{r}
stu <- data[student_responses > 0]

stu %>%
  filter(thread_length <= 30) %>%
  ggplot(aes(student_responses, color = factor(thread_owner_role))) + 
  stat_ecdf()

r1 <- stu[thread_owner_role == "P" & thread_length <= 16, student_responses]
r2 <- stu[thread_owner_role == "S" & thread_length <= 16, student_responses]

t.test(r1, r2)

```



Faculty exhibit the same pattern of responsiveness to a much greater degree - 
99% of threads have two or less faculty responses. This alone is not problematic
because expecting high faculty responsiveness in every thread is unreasonably burdensome.
However, this pattern persists even when we limit threads to have at least some faculty
involvement. 70% of all threads in this subset still have only a single faculty response.
So, even when there is some form of faculty engagement faculty responsiveness
is still quite limited.


prop stu responded to graph!!!


```{r}
data %>%
  filter(!is.na(prop_stu_responded_to),
         studs_in_thread > 0,
         studs_in_thread <= 30,
         num_fac_posts > 0) %>%
  ggplot(aes(prop_stu_responded_to)) +
  geom_histogram()
  


```





#-------------------------------------------------------------------------------#


### Working Notes:


find examples of really good thread usage (think about number of participants,
posts per student)

  - this should start giving you an idea of the "types" of threads:
    - discussion + reply
    - group discussion
    - instructor announcements
    - Q/A sesh
    - etc. 

```{r, eval = FALSE}
log <- file("thread_log.txt", open = 'wt')

data <- as.data.frame(data)
# Send summaries of variables to the log
for (i in seq_along(data)){
  if (is.numeric(unlist(data[, i]))) {
    cat("\n", file = log)
    cat(names(data)[i], "\n", file = log)
    capture.output(summary(data[, i]), file = log)
  }
}

close(log)
```

